<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../">
  <title data-ice="title">js/base/services/DataService.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <a data-ice="repoURL" href="https://github.com/SynthesisProject/mobile.git" class="repo-url-github">Repository</a>
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthMobile">SynthMobile</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertToObject">convertToObject</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-convertToString">convertToString</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-generateUID">generateUID</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getNumberOfProperties">getNumberOfProperties</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Routes">Routes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-base">base</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/boot</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-BootCtrl">BootCtrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/controllers</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/controllers/AppController.js~AppController.html">AppController</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/directives</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/AnimatedEllipse.js~AnimatedEllipse.html">AnimatedEllipse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/CurrentModuleName.js~CurrentModuleName.html">CurrentModuleName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/ModuleCollapse.js~ModuleCollapse.html">ModuleCollapse</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/ModuleName.js~ModuleName.html">ModuleName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/OverallSyncStatus.js~OverallSyncStatus.html">OverallSyncStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/SynthAttachments.js~SynthAttachments.html">SynthAttachments</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/SynthFooter.js~SynthFooter.html">SynthFooter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/SynthMenu.js~SynthMenu.html">SynthMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/ToolName.js~ToolName.html">ToolName</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/directives/ToolSyncStatus.js~ToolSyncStatus.html">ToolSyncStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AnimatedEllipseFactory">AnimatedEllipseFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-CurrentModuleNameFactory">CurrentModuleNameFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ModuleCollapseFactory">ModuleCollapseFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ModuleNameFactory">ModuleNameFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-OverallSyncStatusFactory">OverallSyncStatusFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthAttachmentsFactory">SynthAttachmentsFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthMenuFactory">SynthMenuFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ToolNameFactory">ToolNameFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ToolSyncStatusFactory">ToolSyncStatusFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthFooterFactory">SynthFooterFactory</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/factories</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/factories/AppSyncStatus.js~AppSyncStatus.html">AppSyncStatus</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/factories/Lock.js~Lock.html">Lock</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/factories/UserSession.js~UserSession.html">UserSession</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AppSyncStatusFactory">AppSyncStatusFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-LockFactory">LockFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UserSessionFactory">UserSessionFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthAuthenticateUser">SynthAuthenticateUser</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthCheckResponseError">SynthCheckResponseError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthError">SynthError</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthErrorHandler">SynthErrorHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthFail">SynthFail</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-safo">safo</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/filters</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ArrayToObjectFilter">ArrayToObjectFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ArrayToObjectFilterFactory">ArrayToObjectFilterFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AttachmentsFilter">AttachmentsFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AttachmentsFilterFactory">AttachmentsFilterFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BytesToSizeFilter">BytesToSizeFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BytesToSizeFilterFactory">BytesToSizeFilterFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-FormatDateFilter">FormatDateFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-FormatDateFilterFactory">FormatDateFilterFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Object2ArrayFilter">Object2ArrayFilter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Object2ArrayFilterFactory">Object2ArrayFilterFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-NoEscapeFilterFactory">NoEscapeFilterFactory</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/handlers</div><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthAttachmentMinerProvider">SynthAttachmentMinerProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthDeleteHandlerProvider">SynthDeleteHandlerProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthEmbeddedImageHandlerProvider">SynthEmbeddedImageHandlerProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthLinkHandlerProvider">SynthLinkHandlerProvider</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthAttachmentMinerProvider">SynthAttachmentMinerProvider</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/home</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/home/HomeCtrl.js~HomeCtrl.html">HomeCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/home/HomeService.js~HomeService.html">HomeService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-HomeServiceFactory">HomeServiceFactory</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/register</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RegisterCtrl">RegisterCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RegisterModuleRegistrationCtrl">RegisterModuleRegistrationCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RegisterSelectModuleCtrl">RegisterSelectModuleCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-RegisterService">RegisterService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/services</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/services/RegistrationService.js~RegistrationService.html">RegistrationService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/services/SynthesisRESTClient.js~SynthesisRESTClient.html">SynthesisRESTClient</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/services/UserService.js~UserService.html">UserService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/services/UserSettings.js~UserSettings.html">UserSettings</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-RegistrationServiceFactory">RegistrationServiceFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SynthesisRESTClientFactory">SynthesisRESTClientFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UserServiceFactory">UserServiceFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-UserSettingsFactory">UserSettingsFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-DataService">DataService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-LoggerService">LoggerService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ModuleService">ModuleService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-PushService">PushService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SyncAPIService">SyncAPIService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/settings</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SettingsCtrl">SettingsCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SettingsPushCtrl">SettingsPushCtrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">base/sync</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/base/sync/SyncSelection.js~SyncSelection.html">SyncSelection</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SyncSelectionFactory">SyncSelectionFactory</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SyncConfigureCtrl">SyncConfigureCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SyncCtrl">SyncCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SyncProgressCtrl">SyncProgressCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SyncService">SyncService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SynthesisTools">SynthesisTools</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/announcements</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Config">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementsTool">AnnouncementsTool</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/announcements/controllers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementDetailCtrl">AnnouncementDetailCtrl</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementListCtrl">AnnouncementListCtrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/announcements/handlers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementsDeleteHandler">AnnouncementsDeleteHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementsImageHandler">AnnouncementsImageHandler</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AnnouncementsLinkHandler">AnnouncementsLinkHandler</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/announcements/services</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/js/tools/announcements/services/AnnouncementService.js~AnnouncementService.html">AnnouncementService</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-AnnouncementServiceFactory">AnnouncementServiceFactory</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/resources</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Config">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ResourcesTool">ResourcesTool</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/resources/controllers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ResourcesCtrl">ResourcesCtrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/resources/directives</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resourceImg">resourceImg</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-resourceListItem">resourceListItem</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/resources/factories</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ResourcesService">ResourcesService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/resources/handlers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ResourcesDeleteHandler">ResourcesDeleteHandler</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/schedule</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Config">Config</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ScheduleTool">ScheduleTool</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/schedule/controllers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ScheduleCtrl">ScheduleCtrl</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/schedule/factories</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ScheduleService">ScheduleService</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">tools/schedule/handlers</div><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-ScheduleLinkHandler">ScheduleLinkHandler</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">js/base/services/DataService.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">&apos;use strict&apos;;
import {convertToString} from &apos;../Utilities&apos;;
import bases from &apos;bases&apos;;
/*
 * base/js/services/DataService.js
 * Create factory for the DataService
 */
var DataService = ($q, $http, $rootScope, LoggerService, SynthError, UserSession, SynthConfig, Lock) =&gt; {

	var LOG = LoggerService(&apos;DataService&apos;);
	// Characters that will be used to generate filenames
	// Windows Quirks
	// - case insensitive, hense no capitals
	// - underscores are not allowed
	// No other special characters are used because to mess with sorting
	const FILENAME_CHARS = &apos;0123456789abcdefghijklmnopqrstuvwxyz&apos;;

	// The lock key that is used when generating new file names
	const FILE_CREATE_LOCK = &apos;DataService.FILE_CREATE_LOCK&apos;;


	/**
	 * Constructor
	 */
	class DataServiceImpl{

		constructor(){
			this.cachedRouteFileSystem = null;
		}

		/**
		 * TODO remove this, device will be ready before angular starts
		 */
		cordovaReady(){
			return $q.when();
		}

		/**
		 * Gets the directory in which content data is stored
		 * /Synthesis/content/
		 */
		getContentDirectory (){
			return this.checkAndCreateDirectory(&apos;content&apos;);
		}

		/**
		 * /Synthesis/data/
		 */
		getDataDirectory(){
			return this.checkAndCreateDirectory(&apos;data&apos;);
		}

		/**
		 * Gets a file in the data directory
		 */
		getDataFile(filename){
			return this.getFileData(&apos;data&apos;, filename);
		}

		/**
		 * Merge json to a file in the /Synthesis/data directory
		 * @param filename Name of the file inside of /Synthesis/data/
		 * @param jsonObject The object to merge into this file
		*/
		mergeDataFile(filename, jsonObject){
			return this.mergeToFile(&apos;data&apos;, filename, jsonObject);
		}

		/**
		 * Creates a new file in the data directory of the app
		 * This file will be created in an abitrary directory under /Synthesis/data/{generatedFolder}/{filename}
		 * @param filename Name of the file to create. E.g. MyImage.png
		 * @returns A promise resolving to the FileEntry representing the file
		 */
		createNewFile(filename){
			var dataDirEntry;
			const self = this;
			function getLock(){
				return Lock.getLock(FILE_CREATE_LOCK);
			}

			function getContentDirectory(){
				return self.getContentDirectory();
			}

			/**
			 * Gets the listing of all files within the DirectoryEntry
			 * @param dirEntry Directory entry to get the contents listing of
			 * @returns A promise that resolves to an array of entries.
			 */
			function getDirectoryListing(dirEntry){
				dataDirEntry = dirEntry;
				var listingDefered = $q.defer();
				var dirReader = dataDirEntry.createReader();
				var entries = [];

				// Call the reader.readEntries() until no more results are returned.
				// TODO uptomise and only get the last directory name
				var readEntries = function() {
					dirReader.readEntries((results) =&gt;{
						// If no more entries are found, we are done
						if (!results.length) {
							listingDefered.resolve(entries.sort((fileEntry1, fileEntry2) =&gt; {
								var name1 = fileEntry1.name, name2 = fileEntry2.name;
								if(name1.length !== name2.length){
									return name1.length - name2.length;
								}
								return name1.localeCompare(name2);
							}));
						}
						else{
							entries = entries.concat(Array.prototype.slice.call(results || [], 0));
							readEntries();
						}
					}, (error) =&gt;{
						LOG.warn(&apos;Failed to get directory listing, code:&apos; + error.code);
						listingDefered.reject(SynthError(1004, error.code));
					});
				};
				readEntries(); // Start reading dirs.
				return listingDefered.promise;
			}

			/**
			 * Finds the next available directory based on the array of files within the
			 * file listing
			 * @param fileListing Array of files in the contants directory
			 * @returns A name of the next available filename that can be used.
			 */
			function findNextOpenDirectory(fileListing){
				// If there is no files yet, we start with 1.ext
				if(fileListing.length === 0){
					return $q.when(FILENAME_CHARS.charAt(0));
				}
				// Else we take the last file in the list, and get the next available name
				else {
					// Get the file name
					var lastDirectoryName = fileListing[fileListing.length - 1].name;
					var index = bases.fromAlphabet(lastDirectoryName, FILENAME_CHARS);
					var newDirectoryName = bases.toAlphabet(index + 1, FILENAME_CHARS);
					return $q.when(newDirectoryName);
				}
			}

			/**
			 * Creates the new directory
			 * @param directoryName Name of the directory to create
			 * @returns A promise that resolves with the DirectoryEntry
			 */
			function createNewDirectory(directoryName){
				var deferred = $q.defer();
				dataDirEntry.getDirectory(directoryName, {create : true, exclusive : true}, (dirEntry) =&gt; {
					deferred.resolve(dirEntry);
				},
				// Error Creating directory
				(error) =&gt; {
					LOG.warn(`Error creating path ${directoryName} : ${error}`);
					deferred.reject(SynthError(1004, error));
				});
				return deferred.promise;
			}

			function createFile(directoryEntry){
				var deferred = $q.defer();
				directoryEntry.getFile(filename, {create : true},
					(fileEntry) =&gt; {
						LOG.debug(&apos;Created new file: &apos; + fileEntry.toInternalURL());
						deferred.resolve(fileEntry);
					},
					() =&gt; {
						LOG.warn(&apos;Failed to create file&apos;);
						deferred.reject(SynthError(1004));
					}
				);
				return deferred.promise;
			}

			return getLock()
				.then(getContentDirectory)
				.then(getDirectoryListing)
				.then(findNextOpenDirectory)
				.then(createNewDirectory)
				.then(createFile)
				.then((returnData) =&gt; {
					return Lock.returnLock(FILE_CREATE_LOCK, returnData);
				}, (reason) =&gt;{
					return Lock.returnLock(FILE_CREATE_LOCK, reason, false);
				});
		}


		/**
		 * Gets the root directory where the application is writing files
		 */
		getApplicationRoot(){
			const deferred = $q.defer();
			// TODO remove the false!
			// if (false &amp;&amp; this.cachedRouteFileSystem !== null){
			//deferred.resolve(this.cachedRouteFileSystem);
			//}
			//else {
			var self = this;
			this.cordovaReady().then(() =&gt; {
				window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotFS, fail);
				function gotFS(fileSystem) {
					fileSystem.root.getDirectory(SynthConfig.dataDir, {create : true, exclusive : false},
						(directory) =&gt; {
							self.cachedRouteFileSystem = directory;
							deferred.resolve(directory);
						}, (error) =&gt; {
							LOG.warn(&apos;Failed to get application root : &apos; + error);
							deferred.reject(SynthError(1004, error.code));
						}
					);
				}
				function fail(error) {
					LOG.warn(&apos;Failed to get filesystem, code:&apos; + error.code);
					deferred.reject(SynthError(1004, error.code));
				}
			});
			//}
			return deferred.promise;
		}

		/**
		 * Checks if the specified path exists, and creates all parent directories
		 * if required.
		 * The path is created from the root of the application path
		 */
		checkAndCreateDirectory(path){
			const deferred = $q.defer();
			this.getApplicationRoot().then(
				function(root){

					// Throw out &apos;./&apos; or &apos;/&apos; and move on to prevent something like &apos;/foo/.//bar&apos;.
					function removeBlanks(folders){
						if (folders.length &gt; 0 &amp;&amp; (folders[0] === &apos;.&apos; || folders[0] === &apos;&apos;)) {
							folders = folders.slice(1);
							return removeBlanks(folders); // Call again to check the next one too
						}
						else{
							return folders;
						}
					}

					function createDir (rootDirEntry, folders){
						folders = removeBlanks(folders);

						// If there are no more folders left, this is it
						if (folders.length === 0){
							deferred.resolve(rootDirEntry);
							return;
						}

						var folder = folders[0];
						let foldersLeft = folders.slice(1);
						//LOG.debug(&apos;Creating directory : &apos; + folder + &apos; in parent: &apos; + rootDirEntry.fullPath);
						rootDirEntry.getDirectory(folder, {create : true, exclusive : false}, (dirEntry) =&gt; {
							// Recursively add the new subfolder (if we still have another to create).
							if (foldersLeft.length &gt; 0) {
								createDir(dirEntry, foldersLeft);
							}
							else{
								deferred.resolve(dirEntry);
							}
						},
						// Error Creating directory
						(error) =&gt; {
							LOG.warn(`Error creating path ${path} : ${error}`);
							deferred.reject(SynthError(1004, error));
						});
					}
					var rootPath = `cdvfile://localhost/persistent/${SynthConfig.dataDir}`;
					if(path.indexOf(rootPath) === 0){
						path = path.substring(rootPath.length);
					}

					createDir(root, path ? path.split(&apos;/&apos;) : []);
				});
			return deferred.promise;
		}

		/**
		 * Gets the full path of the root directory.
		 * The success of the promise will return a string of the full path
		 * to the application root directory.
		 */
		getLocalFilePath(){
			const deferred = $q.defer();
			this.getApplicationRoot().then(
				// Success
				(root) =&gt; {
					deferred.resolve(root.fullPath);
				},
				// Failed
				(error) =&gt; {
					deferred.reject(SynthError(1004, error));
				}
			);
			return deferred.promise;
		}

		/**
		 * Writes to the data file of a tool.
		 * NOTE: This function will replace the current data file of the tool
		 *
		 * @param moduleId - Id of the module this tool is in.
		 * @param toolname - Name of the tool to write data to.
		 * @param jsonData - Either a JSON Object, or a JSON string that represents the data
		 * that should be written to the tool&apos;s data file
		 * @param isUploadData - Flag if the data is for the upload file of the tool (optional, default=false)
		 */
		writeToolData(moduleId, toolname, jsonData, isUploadData){
			const deferred = $q.defer();
			this.getDataDirectory().then(
				// Success
				function(root){
					var filename = moduleId + &apos;-&apos; + toolname + (isUploadData ? &apos;.up.json&apos; : &apos;.json&apos;);
					root.getFile(filename, {create : true, exclusive : false},
						(fileEntry) =&gt; {
							fileEntry.createWriter(onWriterReady, fail);
						}, fail);

					function onWriterReady(writer) {
						writer.onwriteend = function() {
							deferred.resolve();
						};

						var dataString = convertToString(jsonData);
						if (dataString != null){
							writer.write(dataString);
						}
						else{
							LOG.warn(&apos;Failed while trying to write tool data, Invalid data type given to write as tool data&apos;);
							deferred.reject(SynthError(1000, &apos;Invalid data type given to write as tool data&apos;));
						}
					}
					/**
					 * Function for when an IO action fails
					 */
					function fail(error) {
						LOG.warn(&apos;Failed while trying to write tool data, error : &apos; + error);
						deferred.reject(SynthError(1004));
					}
				},
				// Fail
				function(){
					deferred.reject();
				}
			);
			return deferred.promise;
		}

		/**
		 * Write content to a file
		 *
		 * @param directoryPath - Path of the directory to write in.
		 * @param filename - Name of the file to write in.
		 * @param data - Data to write to the file. The data can be a string or a JSON object
		 * which will be converted to a json string.
		 */
		writeToFile(directoryPath, filename, data){
			const self = this;

			function writeFile(directory){
				var writeDeferred = $q.defer();
				directory.getFile(filename, {create : true, exclusive : false},
					(fileEntry) =&gt; {
						fileEntry.createWriter(onWriterReady, fail);
					}, fail);

				// Writer is ready to write
				function onWriterReady(writer) {
					writer.onwriteend = function() {
						writeDeferred.resolve(data);
						self.busyWriting = false;
					};
					var outputData = convertToString(data);
					writer.write(outputData);
				}
				// Function for when an IO action fails
				function fail(error) {
					LOG.warn(&apos;Failed while trying to write to file, error: &apos; + error);
					writeDeferred.reject(SynthError(1004));
				}
				return writeDeferred.promise;
			}


			return this.checkAndCreateDirectory(directoryPath).then(
				// Success getting directory path
				function(directory){
					// First get a write lock on the file
					return Lock.getLock(`${directoryPath}${filename}`)
					// Now write to the file
						.then(() =&gt; {
							return writeFile(directory);
						})
					// Return our lock on the file
						.then((writtenData) =&gt; {
							return Lock.returnLock(`${directoryPath}${filename}`, writtenData);
						}, (reason) =&gt; {
							return Lock.returnLock(`${directoryPath}${filename}`, reason, false);
						});
				},
				// Failed to get directory path
				function(error){
					LOG.warn(&apos;Failed while trying to write to file, error: &apos; + error);
					return $q.reject(SynthError(1004));
				});
		}

		/**
		 * Copies content from the web to a file
		 */
		copyFromWebToFile(webPath, directoryPath, filename){
			const deferred = $q.defer(),
				self = this;
			this.getWebData(webPath).then(
				// Success
				(data) =&gt; {
					copyDataToFile(data);
				},
				// Failed
				(error) =&gt; {
					LOG.warn(&apos;Failed to get web data : &apos; + error);
					deferred.reject(SynthError(1004));
				});
			// Function to copy the web data to the file
			function copyDataToFile(data){
				self.writeToFile(directoryPath, filename, data).then(
					// Success
					() =&gt; {
						deferred.resolve();
					},
					// Failed
					(error) =&gt; {
						LOG.warn(&apos;Failed while trying to copy file from web, error: &apos; + error);
						deferred.reject(SynthError(1004));
					}
				);
			}
			return deferred.promise;
		}

		/**
		 * Merge content to a file.
		 * The newly merged data object is returned
		 */
		mergeToFile(directoryPath, filename, jsonObject){
			const deferred = $q.defer(),
				self = this;
			// Get the original contents of the file
			this.getFileData(directoryPath, filename).then(
				// Success
				(data) =&gt; {
					// Merge the new data to the old data
					let writeData = angular.merge(data || {}, jsonObject);


					// Write the merged data to the file
					self.writeToFile(directoryPath, filename, JSON.stringify(writeData)).then(
						// Success
						() =&gt; {
							deferred.resolve(writeData);
						},
						//Fail
						(error) =&gt; {
							deferred.reject(error);
						}
					);
				},
				//Fail
				function (error){
					deferred.reject(error);
				}
			);
			return deferred.promise;
		}

		/**
		 * Get data from a web json source
		 */
		getWebData(webPath){
			return $http({ &apos;method&apos; : &apos;GET&apos;, &apos;url&apos; : webPath})
				.then((response) =&gt; {
					return response.data;
				}, () =&gt; {
					return $q.reject(SynthError(1004));
				});
		}

		/**
		 * Gets the JSON object from a file
		 */
		getFileData(directoryPath, filename){
			LOG.debug(&apos;Getting data for: directroy=&apos; + directoryPath + &apos;, filename=&apos; + filename);
			const deferred = $q.defer(),
				self = this;
			this.checkAndCreateDirectory(directoryPath).then(
				// Success
				(directory) =&gt; {
					directory.getFile(filename, {create : true},
						(fileEntry) =&gt; {
							self.getFileAsObject(fileEntry).then(
								// Success
								(object) =&gt; {
									if(LOG.isDEBUG()){
										LOG.debug(&apos;Got data :&apos; + JSON.stringify(object));
									}
									deferred.resolve(object);
								},
								// Fail
								(error) =&gt; {
									deferred.reject(error);
								}
							);
						},
						() =&gt; {
							LOG.warn(&apos;Fail while trying to get file in directory&apos;);
							deferred.reject(SynthError(1004));
						}
					);

				},
				// Failed
				(error) =&gt; {
					deferred.reject(error);
				});
			return deferred.promise;
		}

		/**
		 * Make sure the files exists that prevent the device from scanning for library
		 * content in the Application directory
		 */
		ensureNoMediaScanFiles(){
			return this.writeToFile(&apos;&apos;, &apos;.nomedia&apos;);
		}


		/**
		 * Gets the size of the upload data
		 */
		getToolUploadDataSize(moduleId, toolname){
			const deferred = $q.defer();
			this.getDataDirectory().then(
				// Success
				(toolRoot) =&gt; {
					const filename = `${moduleId}-${toolname}.up.json`;
					/*
					 * TODO do we have to create the file ?!
					 * This will cause each tool to have an upload file
					 * even will it will always be empty, the file will get
					 * created when checking for sync
					 */
					toolRoot.getFile(filename, {create : true},
						(fileEntry) =&gt; {
							fileEntry.file(
								(file) =&gt; {
									deferred.resolve(file.size);
								}, fail);

						}, fail
					);
				}, fail
			);

			function fail(error){
				deferred.reject(error);
			}

			return deferred.promise;
		}

		/**
		 * Delete the upload data file for a tool
		 */
		deleteToolUploadData(moduleId, toolname){
			const deferred = $q.defer();
			this.getToolDataFile(moduleId, toolname, true).then(
				// Success
				(fileEntry) =&gt; {
					fileEntry.remove(
						() =&gt; {
							deferred.resolve();
						},
						() =&gt; {
							LOG.warn(&apos;Error deleting upload file&apos;);
							deferred.reject(SynthError(1004, &apos;Error deleting upload file&apos;));
						});
				},
				//Fail
				(error) =&gt; {
					deferred.reject(error);
				}
			);
			return deferred.promise;
		}

		/**
		 * Deletes a file in the contents directory
		 */
		deleteCDVFile(cdvFilePath){
			const deferred = $q.defer();
			LOG.warn(&apos;Going to delete file: &apos; + cdvFilePath);
			window.resolveLocalFileSystemURL(cdvFilePath,
				// Got the local file
				function(fileEntry){
					fileEntry.remove(() =&gt; {
						deferred.resolve();
					}, (error) =&gt; {
						LOG.warn(&apos;Failed to delete file : &apos; + cdvFilePath);
						deferred.reject(error);
					});
				},
				// Failed to get the file
				() =&gt; {
					LOG.warn(&apos;Error getting file to delete: &apos; + cdvFilePath + &apos;, assuming file is already deleted.&apos;);
					deferred.resolve();
				});
			return deferred.promise;
		}

		/**
		 * Deletes an array of files
		  @param deleteFiles Array of cdv:// file protocal file path
		 */
		deleteCDVFiles(filePaths = []){
			let promise = $q.when();
			const self = this;
			angular.forEach(filePaths, function(filePath){
				promise = promise.then(function(){
					return self.deleteToolFile(filePath);
				});
			});
			return promise;
		}

		/**
		 * Gets the file entry for a tool&apos;s data file
		 * @param moduleId - ID of the module for the tool
		 * @param toolname - Name of the tool to get data file of
		 * @param isUploadData - Flag if the data file should be the upload file
		 */
		getToolDataFile(moduleId, toolname, isUploadData){
			const deferred = $q.defer();
			this.getDataDirectory().then(
				// Success
				(toolRoot) =&gt; {
					var filename = moduleId + &apos;-&apos; + toolname + (isUploadData ? &apos;.up.json&apos; : &apos;.json&apos;);
					toolRoot.getFile(filename, {create : true},
						(fileEntry) =&gt; {
							deferred.resolve(fileEntry);
						},
						(error) =&gt; {
							LOG.warn(&apos;Error getting tool data file, error: &apos; + error);
							deferred.reject(SynthError(1004));
						}
					);
				},
				//Fail
				(error) =&gt; {
					deferred.reject(error);
				}
			);
			return deferred.promise;
		}

		getFileContentCDV(cdvFilePath){
			const deferred = $q.defer();

			window.resolveLocalFileSystemURL(cdvFilePath,
				// Got the local file
				function(fileEntry){
					fileEntry.file((file) =&gt; {
						var reader = new FileReader();
						reader.onloadend = function (evt) {
							deferred.resolve(evt.target.result);
						};
						reader.readAsText(file);
					}, () =&gt; {
						deferred.reject(SynthError(1004));
					});
				},
				// Failed to get the file
				() =&gt; {
					deferred.reject(SynthError(1004));
				});
			return deferred.promise;
		}

		/**
		 * Get the contents of a file without any special conversions
		 */
		getFileContent(toolId, moduleId, filePath){
			const self = this;
			var dataDir = null;
			// Returns a promise to get the tools data dir
			function getToolDataDirPromise(){
				return self.getDataDirectory(moduleId, toolId)
					.then((dir) =&gt; {
						dataDir = dir;
					});
			}

			// Returns a promise to get the content of the file
			function getContentPromise(){
				const deferred = $q.defer();
				LOG.debug(&apos;Getting content of file: &apos; + dataDir.nativeURL + &apos;/&apos; + filePath);
				dataDir.getFile(filePath, null,
					// Got file
					function(fileEntry){
						fileEntry.file((file) =&gt; {
							var reader = new FileReader();
							reader.onloadend = function (evt) {
								deferred.resolve(evt.target.result);
							};

							reader.readAsText(file);
						}, () =&gt; {
							deferred.reject(SynthError(1004));
						});
					},
					// Failed to get file
					() =&gt; {
						deferred.reject(SynthError(1004));
					});
				return deferred.promise;
			}

			return getToolDataDirPromise()
				.then(getContentPromise);
		}

		/**
		 * Gets a file as an object
		 */
		getFileAsObject(fileEntry){
			const deferred = $q.defer();
			fileEntry.file((file) =&gt; {
				var reader = new FileReader();
				reader.onloadend = function (evt) {
					if (evt.target.result === &apos;&apos;){
						deferred.resolve({});
					}
					else{
						try {
							LOG.debug(&apos;File content for &apos; + fileEntry.toURL());
							LOG.debug(evt.target.result);
							deferred.resolve(angular.fromJson(evt.target.result));
						}
						catch(e){
							LOG.warn(&apos;Failed to create object from json string : \n&apos; + evt.target.result);
							deferred.reject(SynthError(1004));
						}
					}
				};
				reader.readAsText(file);
			}, fail);

			function fail(error) {
				LOG.warn(&apos;Failed getting file as object, error : &apos; + error);
				deferred.reject(SynthError(1004, error));
			}
			return deferred.promise;
		}

		/**
		 * Checks if a file exist
		 */
		doesFileExist(filePath){
			const deferred = $q.defer();
			this.getApplicationRoot().then(
				// Success
				function(fileSystem){
					fileSystem.getFile(filePath, { create : false },
						// It exists
						() =&gt; {
							deferred.resolve(true);
						},
						// It does not exist
						() =&gt; {
							deferred.resolve(false);
						});
				},
				// Failed
				(error) =&gt; {
					deferred.reject(error);
				}
			);

			return deferred.promise;
		}

		/**
		 * This method will delete ALL application data from the user&apos;s device.
		 */
		deleteAllApplicationData(){
			const deferred = $q.defer();
			UserSession.clearSession();
			this.getApplicationRoot().then(
				// Success
				(dataDirectoryEntry) =&gt; {
					dataDirectoryEntry.removeRecursively(
						() =&gt; {
							// Broadcast that all caches should be cleared
							$rootScope.$broadcast(&apos;app.clearAllCache&apos;);
							deferred.resolve();
						},
						() =&gt; {
							deferred.reject(SynthError(1004, &apos;Error deleting all aplication data&apos;));
						});
				},
				// Failed
				(error) =&gt; {
					deferred.reject(error);
				});

			return deferred.promise;
		}

	}

	return new DataServiceImpl();
};
DataService.$inject = [&apos;$q&apos;, &apos;$http&apos;, &apos;$rootScope&apos;, &apos;LoggerService&apos;, &apos;SynthError&apos;, &apos;UserSession&apos;, &apos;SynthConfig&apos;, &apos;Lock&apos;];
export default DataService;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.8)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
